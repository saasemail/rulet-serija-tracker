// pages/index.tsx

'use client'

import { useState, useEffect, useRef } from 'react'

export default function Home() {
  const [brojevi, setBrojevi] = useState<number[]>([])
  const inputRef = useRef<HTMLInputElement>(null)

  // Detekcija i analiza na klik dugmeta
  const analiziraj = () => {
    if (brojevi.length < 6) return alert('Unesi vi≈°e brojeva za analizu.')

    // Brojevi sortirani po redu unosa (najnoviji levo)
    const istorija = [...brojevi].reverse()

    const kolone = {
      prva: [1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34],
      druga: [2, 5, 8, 11, 14, 17, 20, 23, 26, 29, 32, 35],
      treca: [3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36]
    }

    const kolonaZaBroj = (br: number) => {
      if (kolone.prva.includes(br)) return 'prva'
      if (kolone.druga.includes(br)) return 'druga'
      if (kolone.treca.includes(br)) return 'treca'
      return 'nepoznata'
    }

    const poslednjih = istorija.slice(0, 15) // uzimamo poslednjih 15 za pametnu analizu
    const koloneIstorija = poslednjih.map(kolonaZaBroj)

    // Tra≈æimo najdu≈æu odsutnu kolonu
    const poslednjaKolona = kolonaZaBroj(poslednjih[0])
    const brojac: Record<string, number> = { prva: 0, druga: 0, treca: 0 }

    for (let i = 0; i < koloneIstorija.length; i++) {
      brojac[koloneIstorija[i]]++
    }

    const najreƒëaKolona = Object.entries(brojac).sort((a, b) => a[1] - b[1])[0][0]

    if (najreƒëaKolona !== poslednjaKolona) {
      alert(`KRENI na ${najreƒëaKolona.toUpperCase()} kolonu!`)
    } else {
      alert('Nema jasnog signala.')
    }
  }

  // Handler za Enter unos
  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
    if (e.key === 'Enter' && inputRef.current) {
      const val = parseInt(inputRef.current.value)
      if (!isNaN(val) && val >= 1 && val <= 36) {
        setBrojevi(prev => [val, ...prev])
        inputRef.current.value = ''
      }
    }
  }

  return (
    <main className="min-h-screen bg-black text-white flex flex-col items-center justify-center space-y-6 p-4">
      <h1 className="text-3xl font-bold">Pametne Kolone ‚Äì Rulet Tracker üéØ</h1>

      <div className="w-full max-w-xl">
        <p className="mb-2 text-center">Poƒçetni brojevi (najnoviji levo kao u kazinu):</p>
        <div className="w-full border border-gray-600 p-3 rounded text-lg bg-gray-900 overflow-x-auto whitespace-nowrap">
          {brojevi.slice(0, 15).join(', ')}
        </div>
      </div>

      <div className="flex flex-col items-center space-y-4">
        <input
          type="number"
          min={1}
          max={36}
          ref={inputRef}
          onKeyDown={handleKeyDown}
          className="text-black p-2 rounded text-lg"
          placeholder="Novi broj"
        />
        <button
          onClick={analiziraj}
          className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded"
        >
          Analiziraj
        </button>
      </div>
    </main>
  )
}
